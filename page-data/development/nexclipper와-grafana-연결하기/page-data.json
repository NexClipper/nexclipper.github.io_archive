{"componentChunkName":"component---src-templates-blog-post-js","path":"/development/nexclipper와-grafana-연결하기/","result":{"data":{"site":{"siteMetadata":{"title":"넥스클리퍼 기술 블로그","author":"[NexClipper]","siteUrl":"https://nexclipper.github.io","comment":{"disqusShortName":"nexclippertechblog","utterances":""},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"7ce2b26f-00f3-548c-afff-ef563b731762","excerpt":"kubernetes가 설치되어있다는 전제하에 시작한다. Prerequisite System Requirements linux Go: 1.11 or above ProtocolBuffer Compiler TimescaleDB Setup build environments Initialize database Install TimescaleDB (docker) Refer to https://docs.timescale.com/latest/getting-started/installation document…","html":"<p>kubernetes가 설치되어있다는 전제하에 시작한다.</p>\n<h1 id=\"prerequisite\"><a href=\"#prerequisite\" aria-label=\"prerequisite permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prerequisite</h1>\n<h2 id=\"system-requirements\"><a href=\"#system-requirements\" aria-label=\"system requirements permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>System Requirements</h2>\n<ul>\n<li>linux</li>\n<li>Go: 1.11 or above</li>\n<li>ProtocolBuffer Compiler</li>\n<li>TimescaleDB</li>\n</ul>\n<h2 id=\"setup-build-environments\"><a href=\"#setup-build-environments\" aria-label=\"setup build environments permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup build environments</h2>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">sudo apt install -y build-essential\nsudo apt install -y protobuf-compiler\ngo get -u github.com/golang/protobuf/protoc-gen-go\nexport PATH=$PATH:~/go/bin</code></pre></div>\n<h1 id=\"initialize-database\"><a href=\"#initialize-database\" aria-label=\"initialize database permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Initialize database</h1>\n<h2 id=\"install-timescaledb-docker\"><a href=\"#install-timescaledb-docker\" aria-label=\"install timescaledb docker permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install TimescaleDB (docker)</h2>\n<p>Refer to <a href=\"https://docs.timescale.com/latest/getting-started/installation\">https://docs.timescale.com/latest/getting-started/installation</a> document for other platform.</p>\n<p>pull <code class=\"language-text\">timescaledb</code> docker image from <a href=\"https://hub.docker.com/r/timescale/timescaledb/\">Docker Hub</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">docker pull timescale/timescaledb:1.5.1-pg11</code></pre></div>\n<p>start with persistent storage</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">docker run -d --name timescaledb -p 5432:5432 -e POSTGRES_PASSWORD=password \\\n  -v [/local/disk/storage]:/var/lib/postgresql/data \\\n  timescale/timescaledb:1.5.1-pg11</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">docker ps | grep timescaledb\n\n423f126c31b5        timescale/timescaledb:1.5.1-pg11   &quot;docker-entrypoint.s…&quot;   18 seconds ago         Up 2 hours          0.0.0.0:5432-&gt;5432/tcp   timescaledb</code></pre></div>\n<p>First connect to the PostgreSQL instance</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">docker exec -it 423f bash\n\nbash-5.0# psql -h localhost -U postgres\npsql (11.5)\nType &quot;help&quot; for help.\n\npostgres=#</code></pre></div>\n<p>Create <code class=\"language-text\">nexclipper</code> database</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># CREATE DATABASE nexclipper;</span>\nCREATE DATABASE\n<span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\q</span>\nbash-5.0<span class=\"token comment\"># exit</span>\n<span class=\"token builtin class-name\">exit</span></code></pre></div>\n<h2 id=\"initialize-tables\"><a href=\"#initialize-tables\" aria-label=\"initialize tables permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Initialize tables</h2>\n<p>Excute database migration command</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">go get github.com/NexClipper/NexClipper\ncd ~/go/github.com/NexClipper/NexClipper\n\ngo mod download\ngo run cmd/migrate/migrate.go --db.host=localhost --db.user=postgres \\\n  --db.pass=password --db.name=nexclipper</code></pre></div>\n<h1 id=\"start-nexclipper\"><a href=\"#start-nexclipper\" aria-label=\"start nexclipper permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Start NexClipper</h1>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">kubectl create namespace nexclipper</code></pre></div>\n<h2 id=\"start-nexserver\"><a href=\"#start-nexserver\" aria-label=\"start nexserver permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Start NexServer</h2>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">cd ~/go/github.com/NexClipper/NexClipper/deployment/kubernetes\n\nvi nexserver.yaml\n\nenv 부분 수정\nex)\nenv:\n            - name: NEXSERVER_DB_HOST\n              value: &quot;192.168.2.65&quot;\n            - name: NEXSERVER_DB_PORT\n              value: &quot;5432&quot;\n            - name: NEXSERVER_DB_USER\n              value: &quot;postgres&quot;\n            - name: NEXSERVER_DB_PASS\n              value: &quot;password&quot;\n            - name: NEXSERVER_DB_NAME\n              value: &quot;nexclipper&quot;</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">kubectl create -f nexserver.yaml</code></pre></div>\n<h2 id=\"start-nexagent\"><a href=\"#start-nexagent\" aria-label=\"start nexagent permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Start NexAgent</h2>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">kubectl get svc -n nexclipper\n\nNAME        TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)           AGE\nnexserver   NodePort   10.96.14.234   &lt;none&gt;        18000:30819/TCP   9s\n\nvi nexagent.yaml\n\nenv 부분 수정\nex)\nenv:\n            - name: NEXAGENT_SERVER_ADDRESS\n              value: 192.168.2.65:30819\n            - name: NEXAGENT_KUBERNETES_NAME\n              value: k8s-cluster\n            - name: NEXAGENT_KUBERNETES_NAMESPACE\n              value: nexclipper</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">kubectl create -f nexagent.yaml</code></pre></div>\n<h1 id=\"install-prometheus-and-grafana\"><a href=\"#install-prometheus-and-grafana\" aria-label=\"install prometheus and grafana permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install Prometheus and Grafana</h1>\n<h2 id=\"install-prometheus\"><a href=\"#install-prometheus\" aria-label=\"install prometheus permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install Prometheus</h2>\n<h3 id=\"create-a-namespace\"><a href=\"#create-a-namespace\" aria-label=\"create a namespace permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create a Namespace</h3>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">kubectl create namespace monitoring</code></pre></div>\n<h3 id=\"create-a-deployment\"><a href=\"#create-a-deployment\" aria-label=\"create a deployment permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create a Deployment</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> prometheus\n<span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> nodes\n  <span class=\"token punctuation\">-</span> nodes/proxy\n  <span class=\"token punctuation\">-</span> services\n  <span class=\"token punctuation\">-</span> endpoints\n  <span class=\"token punctuation\">-</span> pods\n  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"watch\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> extensions\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> ingresses\n  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"watch\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">nonResourceURLs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/metrics\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRoleBinding\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> prometheus\n<span class=\"token key atrule\">roleRef</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io\n  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> prometheus\n<span class=\"token key atrule\">subjects</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> default\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> monitoring</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">kubectl create -f clusterRole.yaml</code></pre></div>\n<h3 id=\"create-a-config-map\"><a href=\"#create-a-config-map\" aria-label=\"create a config map permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create a Config Map</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> prometheus<span class=\"token punctuation\">-</span>server<span class=\"token punctuation\">-</span>conf\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> prometheus<span class=\"token punctuation\">-</span>server<span class=\"token punctuation\">-</span>conf\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> monitoring\n<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">prometheus.yml</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\n    <span class=\"token key atrule\">global</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">scrape_interval</span><span class=\"token punctuation\">:</span> 5s\n      <span class=\"token key atrule\">evaluation_interval</span><span class=\"token punctuation\">:</span> 5s\n\n    <span class=\"token key atrule\">scrape_configs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">job_name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'kubernetes-apiservers'</span>\n        <span class=\"token key atrule\">kubernetes_sd_configs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">role</span><span class=\"token punctuation\">:</span> endpoints\n        <span class=\"token key atrule\">scheme</span><span class=\"token punctuation\">:</span> https\n        <span class=\"token key atrule\">tls_config</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">ca_file</span><span class=\"token punctuation\">:</span> /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n        <span class=\"token key atrule\">bearer_token_file</span><span class=\"token punctuation\">:</span> /var/run/secrets/kubernetes.io/serviceaccount/token\n        <span class=\"token key atrule\">relabel_configs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">source_labels</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>__meta_kubernetes_namespace<span class=\"token punctuation\">,</span> __meta_kubernetes_service_name<span class=\"token punctuation\">,</span> __meta_kubernetes_endpoint_port_name<span class=\"token punctuation\">]</span>\n          <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> keep\n          <span class=\"token key atrule\">regex</span><span class=\"token punctuation\">:</span> default;kubernetes;https\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">job_name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'kubernetes-nodes'</span>\n        <span class=\"token key atrule\">scheme</span><span class=\"token punctuation\">:</span> https\n        <span class=\"token key atrule\">tls_config</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">ca_file</span><span class=\"token punctuation\">:</span> /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n        <span class=\"token key atrule\">bearer_token_file</span><span class=\"token punctuation\">:</span> /var/run/secrets/kubernetes.io/serviceaccount/token\n        <span class=\"token key atrule\">kubernetes_sd_configs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">role</span><span class=\"token punctuation\">:</span> node\n        <span class=\"token key atrule\">relabel_configs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> labelmap\n          <span class=\"token key atrule\">regex</span><span class=\"token punctuation\">:</span> __meta_kubernetes_node_label_(.+)\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">target_label</span><span class=\"token punctuation\">:</span> __address__\n          <span class=\"token key atrule\">replacement</span><span class=\"token punctuation\">:</span> kubernetes.default.svc<span class=\"token punctuation\">:</span><span class=\"token number\">443</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">source_labels</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>__meta_kubernetes_node_name<span class=\"token punctuation\">]</span>\n          <span class=\"token key atrule\">regex</span><span class=\"token punctuation\">:</span> (.+)\n          <span class=\"token key atrule\">target_label</span><span class=\"token punctuation\">:</span> __metrics_path__\n          <span class=\"token key atrule\">replacement</span><span class=\"token punctuation\">:</span> /api/v1/nodes/$<span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span>/proxy/metrics\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">job_name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'kubernetes-pods'</span>\n        <span class=\"token key atrule\">kubernetes_sd_configs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">role</span><span class=\"token punctuation\">:</span> pod\n        <span class=\"token key atrule\">relabel_configs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">source_labels</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>__meta_kubernetes_pod_annotation_prometheus_io_scrape<span class=\"token punctuation\">]</span>\n          <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> keep\n          <span class=\"token key atrule\">regex</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">source_labels</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>__meta_kubernetes_pod_annotation_prometheus_io_path<span class=\"token punctuation\">]</span>\n          <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> replace\n          <span class=\"token key atrule\">target_label</span><span class=\"token punctuation\">:</span> __metrics_path__\n          <span class=\"token key atrule\">regex</span><span class=\"token punctuation\">:</span> (.+)\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">source_labels</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>__address__<span class=\"token punctuation\">,</span> __meta_kubernetes_pod_annotation_prometheus_io_port<span class=\"token punctuation\">]</span>\n          <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> replace\n          <span class=\"token key atrule\">regex</span><span class=\"token punctuation\">:</span> (<span class=\"token punctuation\">[</span>^<span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span>+)(<span class=\"token punctuation\">?</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>\\d+)<span class=\"token punctuation\">?</span>;(\\d+)\n          <span class=\"token key atrule\">replacement</span><span class=\"token punctuation\">:</span> $1<span class=\"token punctuation\">:</span>$2\n          <span class=\"token key atrule\">target_label</span><span class=\"token punctuation\">:</span> __address__\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> labelmap\n          <span class=\"token key atrule\">regex</span><span class=\"token punctuation\">:</span> __meta_kubernetes_pod_label_(.+)\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">source_labels</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>__meta_kubernetes_namespace<span class=\"token punctuation\">]</span>\n          <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> replace\n          <span class=\"token key atrule\">target_label</span><span class=\"token punctuation\">:</span> kubernetes_namespace\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">source_labels</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>__meta_kubernetes_pod_name<span class=\"token punctuation\">]</span>\n          <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> replace\n          <span class=\"token key atrule\">target_label</span><span class=\"token punctuation\">:</span> kubernetes_pod_name\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">job_name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'kubernetes-cadvisor'</span>\n        <span class=\"token key atrule\">scheme</span><span class=\"token punctuation\">:</span> https\n        <span class=\"token key atrule\">tls_config</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">ca_file</span><span class=\"token punctuation\">:</span> /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n        <span class=\"token key atrule\">bearer_token_file</span><span class=\"token punctuation\">:</span> /var/run/secrets/kubernetes.io/serviceaccount/token\n        <span class=\"token key atrule\">kubernetes_sd_configs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">role</span><span class=\"token punctuation\">:</span> node\n        <span class=\"token key atrule\">relabel_configs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> labelmap\n          <span class=\"token key atrule\">regex</span><span class=\"token punctuation\">:</span> __meta_kubernetes_node_label_(.+)\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">target_label</span><span class=\"token punctuation\">:</span> __address__\n          <span class=\"token key atrule\">replacement</span><span class=\"token punctuation\">:</span> kubernetes.default.svc<span class=\"token punctuation\">:</span><span class=\"token number\">443</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">source_labels</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>__meta_kubernetes_node_name<span class=\"token punctuation\">]</span>\n          <span class=\"token key atrule\">regex</span><span class=\"token punctuation\">:</span> (.+)\n          <span class=\"token key atrule\">target_label</span><span class=\"token punctuation\">:</span> __metrics_path__\n          <span class=\"token key atrule\">replacement</span><span class=\"token punctuation\">:</span> /api/v1/nodes/$<span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span>/proxy/metrics/cadvisor\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">job_name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'kubernetes-service-endpoints'</span>\n        <span class=\"token key atrule\">kubernetes_sd_configs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">role</span><span class=\"token punctuation\">:</span> endpoints\n        <span class=\"token key atrule\">relabel_configs</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">source_labels</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>__meta_kubernetes_service_annotation_prometheus_io_scrape<span class=\"token punctuation\">]</span>\n          <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> keep\n          <span class=\"token key atrule\">regex</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">source_labels</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>__meta_kubernetes_service_annotation_prometheus_io_scheme<span class=\"token punctuation\">]</span>\n          <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> replace\n          <span class=\"token key atrule\">target_label</span><span class=\"token punctuation\">:</span> __scheme__\n          <span class=\"token key atrule\">regex</span><span class=\"token punctuation\">:</span> (https<span class=\"token punctuation\">?</span>)\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">source_labels</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>__meta_kubernetes_service_annotation_prometheus_io_path<span class=\"token punctuation\">]</span>\n          <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> replace\n          <span class=\"token key atrule\">target_label</span><span class=\"token punctuation\">:</span> __metrics_path__\n          <span class=\"token key atrule\">regex</span><span class=\"token punctuation\">:</span> (.+)\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">source_labels</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>__address__<span class=\"token punctuation\">,</span> __meta_kubernetes_service_annotation_prometheus_io_port<span class=\"token punctuation\">]</span>\n          <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> replace\n          <span class=\"token key atrule\">target_label</span><span class=\"token punctuation\">:</span> __address__\n          <span class=\"token key atrule\">regex</span><span class=\"token punctuation\">:</span> (<span class=\"token punctuation\">[</span>^<span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span>+)(<span class=\"token punctuation\">?</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>\\d+)<span class=\"token punctuation\">?</span>;(\\d+)\n          <span class=\"token key atrule\">replacement</span><span class=\"token punctuation\">:</span> $1<span class=\"token punctuation\">:</span>$2\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> labelmap\n          <span class=\"token key atrule\">regex</span><span class=\"token punctuation\">:</span> __meta_kubernetes_service_label_(.+)\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">source_labels</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>__meta_kubernetes_namespace<span class=\"token punctuation\">]</span>\n          <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> replace\n          <span class=\"token key atrule\">target_label</span><span class=\"token punctuation\">:</span> kubernetes_namespace\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">source_labels</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>__meta_kubernetes_service_name<span class=\"token punctuation\">]</span>\n          <span class=\"token key atrule\">action</span><span class=\"token punctuation\">:</span> replace\n          <span class=\"token key atrule\">target_label</span><span class=\"token punctuation\">:</span> kubernetes_name</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">kubectl create -f config-map.yaml</code></pre></div>\n<h3 id=\"create-a-prometheus-deployment\"><a href=\"#create-a-prometheus-deployment\" aria-label=\"create a prometheus deployment permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create a Prometheus Deployment</h3>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: prometheus-deployment\n  namespace: monitoring\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: prometheus-server\n  template:\n    metadata:\n      labels:\n        app: prometheus-server\n    spec:\n      containers:\n        - name: prometheus\n          image: prom/prometheus:v2.2.1\n          args:\n            - &quot;--config.file=/etc/prometheus/prometheus.yml&quot;\n            - &quot;--storage.tsdb.path=/prometheus/&quot;\n          ports:\n            - containerPort: 9090\n          volumeMounts:\n            - name: prometheus-config-volume\n              mountPath: /etc/prometheus/\n            - name: prometheus-storage-volume\n              mountPath: /prometheus/\n      volumes:\n        - name: prometheus-config-volume\n          configMap:\n            defaultMode: 420\n            name: prometheus-server-conf\n\n        - name: prometheus-storage-volume\n          emptyDir: {}\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: prometheus-service\n  namespace: monitoring\n  annotations:\n      prometheus.io/scrape: &#39;true&#39;\n      prometheus.io/port:   &#39;9090&#39;\n\nspec:\n  selector:\n    app: prometheus-server\n  type: NodePort\n  ports:\n    - port: 8080\n      targetPort: 9090\n      nodePort: 30000</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">kubectl create -f prometheus-deployment.yaml</code></pre></div>\n<h2 id=\"install-grafana\"><a href=\"#install-grafana\" aria-label=\"install grafana permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install Grafana</h2>\n<h3 id=\"create-a-configmap\"><a href=\"#create-a-configmap\" aria-label=\"create a configmap permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create a Configmap</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> grafana<span class=\"token punctuation\">-</span>datasources\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> monitoring\n<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">prometheus.yaml</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token key atrule\">\"apiVersion\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        <span class=\"token key atrule\">\"datasources\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span>\n               \"access\"<span class=\"token punctuation\">:</span><span class=\"token string\">\"proxy\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token key atrule\">\"editable\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span><span class=\"token punctuation\">,</span>\n                <span class=\"token key atrule\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"prometheus\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token key atrule\">\"orgId\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n                <span class=\"token key atrule\">\"type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"prometheus\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token key atrule\">\"url\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"http://prometheus-service.monitoring.svc:8080\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token key atrule\">\"version\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">kubectl create -f grafana-datasource-config.yaml</code></pre></div>\n<h3 id=\"create-a-grafana-deployment\"><a href=\"#create-a-grafana-deployment\" aria-label=\"create a grafana deployment permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create a Grafana Deployment</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> grafana\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> monitoring\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> grafana\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> grafana\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> grafana\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> grafana\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> grafana/grafana<span class=\"token punctuation\">:</span>latest\n        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> grafana\n          <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span>\n        <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2Gi\"</span>\n            <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1000m\"</span>\n          <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1Gi\"</span>\n            <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"500m\"</span>\n        <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /var/lib/grafana\n            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> grafana<span class=\"token punctuation\">-</span>storage\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /etc/grafana/provisioning/datasources\n            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> grafana<span class=\"token punctuation\">-</span>datasources\n            <span class=\"token key atrule\">readOnly</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> grafana<span class=\"token punctuation\">-</span>storage\n          <span class=\"token key atrule\">emptyDir</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> grafana<span class=\"token punctuation\">-</span>datasources\n          <span class=\"token key atrule\">configMap</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">defaultMode</span><span class=\"token punctuation\">:</span> <span class=\"token number\">420</span>\n              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> grafana<span class=\"token punctuation\">-</span>datasources\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> grafana\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> monitoring\n  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">prometheus.io/scrape</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'true'</span>\n      <span class=\"token key atrule\">prometheus.io/port</span><span class=\"token punctuation\">:</span>   <span class=\"token string\">'3000'</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span> \n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> grafana\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort  \n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span>\n      <span class=\"token key atrule\">nodePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">32000</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">kubectl create -f deployment.yaml</code></pre></div>\n<h1 id=\"nexclipper와-grafana-연동\"><a href=\"#nexclipper%EC%99%80-grafana-%EC%97%B0%EB%8F%99\" aria-label=\"nexclipper와 grafana 연동 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NexClipper와 Grafana 연동</h1>\n<h2 id=\"grafana-접속\"><a href=\"#grafana-%EC%A0%91%EC%86%8D\" aria-label=\"grafana 접속 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Grafana 접속</h2>\n<p><a href=\"http://localhost:32000\">http://localhost:32000</a> 으로 접속하면 grafana 페이지가 나온다.</p>\n<p>초기 ID: admin, PW: admin 으로 접속 후 Configuration(빨간 네모) - Data Sources로 들어간다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABb0lEQVQoz4VRx07DQBTcG0oBQqptHJfdtePgiBBACKTcEEd+FAGpSLR/G95bpziEhMPolZkdzbPF9/sbPj6/MJnO8fQ8wut4htFkTpgtMDe7l9H0D26tYX5MVVQOS2i0bJxU66jWGqjVmwtkPe8sy4YfBGhR3dQ0N/SWfQpxXK2R0IHtuGaxhOO0c70Lzw1M5dm2XdjWWmu1CE3a0xuhWxY8T0JFMaSMEATKoN+/RBQl8L2QuA6Gj/cIpYbXDhF3u7gY3hAnzZzeDnD1cGfeCeuoAq07xswPJHxfrkwZPPNepwk0GYehhlQRVJL1rJGdGOosm8VBoYg47kKp2JC8XApXva8Q6QSDwTXS9NzoeeYLGJreKgrEwUSxWNxItETelKvWMXq9PpIkXRuRQYbYBGKIAhkuH+VT/Tbks825lCSvyYM5USjsNwxMr7a+7a6rRLlcygz+S7gw3JXOcJywUavQOWrrR+wz3NLRBWGQ1R9nRk+uw6GhSAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"grafana home\"\n        title=\"grafana home\"\n        src=\"/static/6aa81b2002d4e34796bf36b99ddc450a/799d3/grafana_home.png\"\n        srcset=\"/static/6aa81b2002d4e34796bf36b99ddc450a/00d96/grafana_home.png 148w,\n/static/6aa81b2002d4e34796bf36b99ddc450a/0b23c/grafana_home.png 295w,\n/static/6aa81b2002d4e34796bf36b99ddc450a/799d3/grafana_home.png 590w,\n/static/6aa81b2002d4e34796bf36b99ddc450a/2a3d6/grafana_home.png 885w,\n/static/6aa81b2002d4e34796bf36b99ddc450a/ae92f/grafana_home.png 1180w,\n/static/6aa81b2002d4e34796bf36b99ddc450a/eff2e/grafana_home.png 1920w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>timescaledb(postgresql)와 연동하기 위해 Add data source 클릭</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABbUlEQVQoz5WS226CQBRFJzWK1QaV+0VQVPDyYOxT9Y9rvaCgtjX9t90zYzBWqWkfVmYyc1hnH4AdDyk+j1/Y7d+xihNskj1S2qf7DyS7A+LtDvEmxXqTYE33q3h7ZrneYLGKBfO3JV7nCzClLiOMRuh0IwSdHppeC+PxBNPpjM4HsG0XumFC0wwoioparY5q9QmlYhnFokQUUXgogDF2ghd7fiDgMrfpn3BdGKYtzvxWANNyYNkOVN2EqWkYjAP4nkUNGqjVG5CpkSzXKKGqQqXuumEJ+AO9pofn4QjdsI8uJQ/DAdpBF0HQE2tEk7zMJuiHHei6DZOm4A1NywWrVKsiSYZG0jYJh2GETi8SEp5Q4LdpkrZI7Tg+1TvnIBmsJElClB1kUoVS8+Q8sZYDf1VZfbZymCSVfwgvL//Cdf2N8D+yPGjkfOE9+b07Vqk83ggv1zzuTcSUhiw+wnXnbO+4HmynecYSP/rvCb8Bfeg8X/sj5tkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"grafana datasource\"\n        title=\"grafana datasource\"\n        src=\"/static/e576f833e63e25233f606db2954e3bb6/799d3/grafana_datasource.png\"\n        srcset=\"/static/e576f833e63e25233f606db2954e3bb6/00d96/grafana_datasource.png 148w,\n/static/e576f833e63e25233f606db2954e3bb6/0b23c/grafana_datasource.png 295w,\n/static/e576f833e63e25233f606db2954e3bb6/799d3/grafana_datasource.png 590w,\n/static/e576f833e63e25233f606db2954e3bb6/2a3d6/grafana_datasource.png 885w,\n/static/e576f833e63e25233f606db2954e3bb6/ae92f/grafana_datasource.png 1180w,\n/static/e576f833e63e25233f606db2954e3bb6/eff2e/grafana_datasource.png 1920w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>SQL 항목에 있는 PostgreSQL을 클릭한다.</p>\n<p>아래와 같이 항목을 작성한 후 <code class=\"language-text\">Save &amp; Test</code> 버튼을 클릭하면 <code class=\"language-text\">Database Connection OK</code> 라는 메세지가 뜬다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABlUlEQVQoz3WR3U/iQBTF+2TXalj6NTMd6ActpQKC2F2UZx99MRp3Y/wTjQIFJPGvO94R0wiUh5OTmbnzu2fuaB/vC6xXa8yLBV5eZ3idzjFfrEjvmM2XeJsVmJIXyzVmxfKAVlS3wNu0gHZq6DAtF5btwnbILQeNZoBWnJL7qP02Ua/XIYQHx+VwHLYvl9HdjTTLduAyAca9L6lLrSRF2ulCeA0wxiH8DExGVMfLul0pBhcSml0BDKMYcdKBbTOCSsggBfMCgouDQHWmAmiGcVJ2UK5iJ+2MntxG3bS/m7Dy3D0A3SQk4JGubxWqhAElTNLs4OVd0BZQ13/tASP6kCzrQqqPoH2VsEo/G5YzrAL6YYLu4A/COEPwQ35LqfO9PoOQ/k5CqZ5cAQxi5PkE+egal5cTjC6uyK9xMRxjOPiLfm+Es2wIz6sAGsbx9iwsjuYoQft5jOgpR/h/iPAf6XGA4IF0fw7/rofmfR+iH8K1+TbQMmtfcypnYTLIcYrJbY6bXg88DcGjBnirCUauVK6l3Ev4CXCVQ3cR6/ZDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"grafana postgre\"\n        title=\"grafana postgre\"\n        src=\"/static/20236ae5e80097abf9647cdf8a1ee009/799d3/grafana_postgre.png\"\n        srcset=\"/static/20236ae5e80097abf9647cdf8a1ee009/00d96/grafana_postgre.png 148w,\n/static/20236ae5e80097abf9647cdf8a1ee009/0b23c/grafana_postgre.png 295w,\n/static/20236ae5e80097abf9647cdf8a1ee009/799d3/grafana_postgre.png 590w,\n/static/20236ae5e80097abf9647cdf8a1ee009/2a3d6/grafana_postgre.png 885w,\n/static/20236ae5e80097abf9647cdf8a1ee009/ae92f/grafana_postgre.png 1180w,\n/static/20236ae5e80097abf9647cdf8a1ee009/eff2e/grafana_postgre.png 1920w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>","frontmatter":{"title":"nexclipper와 grafana 연결하기","date":"December 30, 2019"}}},"pageContext":{"slug":"/development/nexclipper와-grafana-연결하기/","previous":{"fields":{"slug":"/development/기술-블로그-오픈/"},"frontmatter":{"title":"기술 블로그 오픈","category":"development","draft":false}},"next":{"fields":{"slug":"/development/쿠버네티스를-공부해-본-후기/"},"frontmatter":{"title":"쿠버네티스를 공부해 본 후기","category":"development","draft":false}}}}}